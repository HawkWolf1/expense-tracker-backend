<html>
    <head>
        <style>
            h3{text-align: center;}
            p{text-align: center;}

        </style>
        <h3> USER DETAILS </h3>
        <body>

        <form onsubmit="newF(event)">
        <p> <label>NAME</label>
            <input id="name" type="text" name="name" size="50" ><br>

            <label> EMAIL </label>
            <input id="email" type="email" name="email" size="50" ><br>

            <label> PASSWORD </label>
            <input id="password" type="password" name="password" size="50" ><br>

            <button> SIGN UP </button>
        </form>
        </p>
        <a href = "./login.html"> Existing User - LOGIN</a>
        <ul id="listOfUsers"> </ul>

 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>



            <script>
                async function newF(event){
                    event.preventDefault()
                    const name = document.getElementById('name').value
                    const email = document.getElementById('email').value
                    const password = document.getElementById('password').value

                    const myObject = {
                        name,
                        email,
                        password
                    }
                    try{
                        const abc = await axios.post("http://localhost:4000/user/add-user", myObject) // we are doing a post request to the backend
                        showNewUserOnScreen(abc.data.newUserDetail)
                    }
                       
                    catch(err){
                        document.body.innerHTML = document.body.innerHTML + "<h3 style='color:red'> User Exists!!! </h3>"
                        console.log("Error Block: ",err)
                    }                  



                }
                window.addEventListener("DOMContentLoaded", async(event) => {
                    event.preventDefault()
                    try{
                    const xyz = await axios.get("http://localhost:4000/user/get-user")
                    console.log(xyz)
                    for(var i=0; i<xyz.data.userA.length; i++){                       
                             showNewUserOnScreen(xyz.data.userA[i])
                    }
                }
                    catch(err){                       
                        console.log("Error Block: ",err)
                    }
                  
                })


                

                function showNewUserOnScreen(user){
                    
                    const parentNode= document.getElementById('listOfUsers')
                    const childHTML = `<li id=${user.id}> ${user.name} - ${user.email} - ${user.password} 
                                        <button onclick =deleteUser('${user.id}')> Delete User </button>  
                                        <button onclick =editUser('${user.email}','${user.name}','${user.password}','${user.id}')> 
                                        Edit User </button>                                              
                                        </li>`

                    parentNode.innerHTML = parentNode.innerHTML + childHTML
                }




                function editUser(email, name, password, userId){
                    document.getElementById('email').value = email
                    document.getElementById('name').value = name
                    document.getElementById('password').value = password

                    deleteUser(userId)
                }




                const deleteUser = async (userId)=> {
                    // console.log(userId)
                    try {await axios.delete(`http://localhost:4000/user/delete-user/${userId}`)
                    removeUserFromScreen(userId)
                    }
                    catch(err){
                        console.log("Error Block: ",err)
                    }
                }




                function removeUserFromScreen(userId){
                    const parentNode = document.getElementById('listOfUsers')
                    const childNodeToBeDeleted = document.getElementById(userId)

                    parentNode.removeChild(childNodeToBeDeleted)
                }
                
               
                
                
             </script>
        
        </body>
    </head>
</html>