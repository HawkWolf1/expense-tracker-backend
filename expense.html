<html>
    <head>
        <style>
            h3{text-align: center;}
            p{text-align: center;}

        </style>
        <h3> EXPENSE TRACKER </h3>
        <body>

        <form onsubmit="saveToLocalStorage(event)">
        <p> <label>CHOOSE EXPENSE AMOUNT</label>
            <input id="amount" type="number" name="amount" size="50" ><br>

            <label> CHOOSE DESCRIPTION</label>
            <input id="description" type="text" name="description" size="50" ><br>

            <label> CHOOSE CATEGORY </label>
            <select name="category" id="category">
                <option value = 'fuel'>fuel</option>
                <option value = 'food'>food</option>
                <option value = 'vacation'>vacation</option>
                <option value = 'shopping'>shopping</option>
            </select>

            <button> SUBMIT </button>
        </form>
        </p>
        <ul id="listOfUsers"> </ul>

 
        <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.2.1/axios.min.js"></script>



            <script>
                async function saveToLocalStorage(event){
                    event.preventDefault()
                    const amount = document.getElementById('amount').value
                    const description = document.getElementById('description').value
                    const category = document.getElementById('category').value

                    const myObject = {
                        amount,
                        description,
                        category
                    }
                    try{
                        const abc = await axios.post("http://localhost:4000/expense/add-expense", myObject) // we are doing a post request to the backend
                        showNewUserOnScreen(abc.data.newExpenseDetail)
                    }
                       
                    catch(err){
                        document.body.innerHTML = document.body.innerHTML + "<h3 style='color:red'> Description !!! </h3>"
                        console.log("Error Block: ",err)
                    }                  



                }
                window.addEventListener("DOMContentLoaded", async(event) => {
                    event.preventDefault()
                    try{
                    const xyz = await axios.get("http://localhost:4000/expense/get-expense")
                    console.log(xyz)
                    for(var i=0; i<xyz.data.expense.length; i++){                       
                             showNewUserOnScreen(xyz.data.expense[i])
                    }
                }
                    catch(err){                       
                        console.log("Error Block: ",err)
                    }
                  
                })


                

                function showNewUserOnScreen(user){
                    
                    const parentNode= document.getElementById('listOfUsers')
                    const childHTML = `<li id=${user.id}> ${user.amount} - ${user.description} - ${user.category} 
                                        <button onclick =deleteExpense('${user.id}')> Delete Expense </button>  
                                        <button onclick =editExpense('${user.description}','${user.amount}','${user.category}','${user.id}')> 
                                        Edit Expense </button>                                              
                                        </li>`

                    parentNode.innerHTML = parentNode.innerHTML + childHTML
                }




                function editExpense(description, amount, category, userId){
                    document.getElementById('description').value = description
                    document.getElementById('amount').value = amount
                    document.getElementById('category').value = category

                    deleteExpense(userId)
                }




                const deleteExpense = async (userId)=> {
                    // console.log(userId)
                    try {await axios.delete(`http://localhost:4000/expense/delete-expense/${userId}`)
                    removeUserFromScreen(userId)
                    }
                    catch(err){
                        console.log("Error Block: ",err)
                    }
                }




                function removeUserFromScreen(userId){
                    const parentNode = document.getElementById('listOfUsers')
                    const childNodeToBeDeleted = document.getElementById(userId)

                    parentNode.removeChild(childNodeToBeDeleted)
                }
                
               
                
                
             </script>
        
        </body>
    </head>
</html>